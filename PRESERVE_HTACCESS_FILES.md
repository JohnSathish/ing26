# Preserving .htaccess Files During Build

## The Problem

When running `npm run build`, Vite's `emptyOutDir: true` setting deletes everything in the output directory (`public_html/newsite/`), including the `.htaccess` files that are essential for routing.

## âœ… Solution Implemented

### 1. **Created `frontend/public/` Directory**

Vite automatically copies files from the `public/` directory to the build output. I've created:

- `frontend/public/.htaccess` - Main routing file
- `frontend/public/api/.htaccess` - API routing file

### 2. **Updated `vite.config.ts`**

Added `publicDir: 'public'` to tell Vite to copy files from the `public/` directory.

### 3. **Created Post-Build Script**

Created `frontend/scripts/copy-htaccess.js` that:
- Copies `.htaccess` files after build completes
- Ensures they're in the correct locations
- Works as a backup if Vite's public directory copy fails

### 4. **Updated Build Script**

Modified `package.json` build script to:
```json
"build": "tsc -b && vite build && node scripts/copy-htaccess.js"
```

This ensures `.htaccess` files are copied after every build.

---

## ğŸ“ File Structure

```
frontend/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ .htaccess          â† Main routing file
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ .htaccess      â† API routing file
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ copy-htaccess.js    â† Post-build copy script
â””â”€â”€ vite.config.ts          â† Updated with publicDir
```

After build, files are copied to:
```
public_html/newsite/
â”œâ”€â”€ .htaccess              â† Copied from public/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ .htaccess          â† Copied from public/api/
â””â”€â”€ assets/               â† Generated by Vite
```

---

## ğŸš€ Usage

### Build (Automatically Preserves .htaccess)

```bash
cd frontend
npm run build
```

The build process will:
1. âœ… Compile TypeScript
2. âœ… Build React app with Vite
3. âœ… Copy `.htaccess` files from `public/` directory
4. âœ… Run post-build script to ensure files are copied

### Manual Copy (If Needed)

If you need to manually copy `.htaccess` files:

```bash
# From project root
cp frontend/public/.htaccess public_html/newsite/.htaccess
cp frontend/public/api/.htaccess public_html/newsite/api/.htaccess
```

---

## âœ… Verification

After building, verify the files exist:

```bash
# Check main .htaccess
ls -la public_html/newsite/.htaccess

# Check API .htaccess
ls -la public_html/newsite/api/.htaccess
```

Both files should exist and have content.

---

## ğŸ”§ Troubleshooting

### .htaccess Still Missing After Build?

1. **Check `public/` directory exists:**
   ```bash
   ls frontend/public/
   ```

2. **Check post-build script:**
   ```bash
   node frontend/scripts/copy-htaccess.js
   ```

3. **Manually copy files:**
   ```bash
   cp frontend/public/.htaccess public_html/newsite/.htaccess
   cp frontend/public/api/.htaccess public_html/newsite/api/.htaccess
   ```

### Build Script Fails?

If the post-build script fails, you can:

1. **Build without post-script:**
   ```bash
   cd frontend
   tsc -b && vite build
   ```

2. **Then manually copy:**
   ```bash
   node frontend/scripts/copy-htaccess.js
   ```

---

## ğŸ“ Notes

- **Vite's `publicDir`** copies files during build, but the post-build script ensures they're always copied
- **`.htaccess` files are hidden files** - Make sure your file manager shows hidden files
- **File permissions** - Ensure `.htaccess` files have `644` permissions on the server

---

## âœ… Summary

âœ… `.htaccess` files are now in `frontend/public/`  
âœ… Vite config updated to use `publicDir`  
âœ… Post-build script ensures files are copied  
âœ… Build script updated to run post-build copy  

**Your `.htaccess` files will now be preserved during every build!** ğŸ‰

